# This is a default configuration file for containerd.
# It is generated by Kubexm and can be further customized.
version = 2
root = "/var/lib/containerd"
state = "/run/containerd"
oom_score = -999

[grpc]
  address = "/run/containerd/containerd.sock"
  uid = 0
  gid = 0
  max_recv_message_size = 16777216
  max_send_message_size = 16777216

[debug]
  address = "" # No debug socket by default
  level = "info"

[metrics]
  address = "" # No metrics endpoint by default
  grpc_histogram = false

[cgroup]
  path = "" # Let containerd detect

# Plugins section
[plugins]
  # The CRI plugin for Kubernetes
  [plugins."io.containerd.grpc.v1.cri"]
    # sandbox_image is the image used for Kubernetes pods' pause container.
    sandbox_image = "{{ .SandboxImage }}"
    
    [plugins."io.containerd.grpc.v1.cri".containerd]
      snapshotter = "overlayfs" # Common default, ensure kernel supports it.
      default_runtime_name = "runc"
      
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
        runtime_type = "io.containerd.runc.v2"
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
          # SystemdCgroup should be true if systemd is the cgroup driver for the host.
          SystemdCgroup = {{ .SystemdCgroup }}
          
    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/opt/cni/bin"
      conf_dir = "/etc/cni/net.d"
      # max_conf_num = 1
      # conf_template = ""

  # Minimal registry configuration. Mirrors can be added via the ConfigureContainerd runner method.
  [plugins."io.containerd.grpc.v1.cri".registry]
    [plugins."io.containerd.grpc.v1.cri".registry.mirrors]
      [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
        endpoint = ["https://registry-1.docker.io"]