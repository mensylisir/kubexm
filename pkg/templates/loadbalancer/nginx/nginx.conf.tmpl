# Generated by kubexm. DO NOT EDIT.

# Main NGINX process settings
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 768;
}

# TCP/UDP proxy settings
stream {
    # Define the upstream pool of Kubernetes API Servers
    upstream kube_apiserver {
        least_conn;
        {{- range .UpstreamServers }}
        server {{ .Address }}:{{ .Port }};
        {{- end }}
    }

    # Define the server that listens for incoming API Server traffic
    server {
        listen {{ .ListenAddress }}:{{ .ListenPort }};
        proxy_pass kube_apiserver;
        proxy_timeout 30s;
        proxy_connect_timeout 5s;
    }
}

# HTTP block is not used for L4 LB, but is required by nginx.
# You can add a default server here if needed.
http {
    server {
        listen 80 default_server;
        server_name _;
        return 404;
    }
}