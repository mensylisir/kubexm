# ==============================================================================
# This chrony configuration file is generated by Kubexm.
  # DO NOT EDIT THIS FILE MANUALLY.
  #
  # This node is configured as a local NTP SERVER for the cluster.
  # ==============================================================================

  # ------------------------------------------------------------------------------
  # Upstream NTP Servers Configuration
  # ------------------------------------------------------------------------------
  # Use the upstream NTP servers specified in the Cluster configuration.
  # If no external servers are provided, this server will act as an unsynchronized
  # local master clock for the offline cluster.
  {{- if .UpstreamServers }}
  {{- range .UpstreamServers }}
  server {{ . }} iburst
  {{- end }}
  {{- else }}
  # No upstream servers defined. This node will be a local master.
  # The 'local stratum' directive allows it to serve time even if it's not
  # synchronized to a better time source. 10 is a common value for local masters.
  local stratum 10
  {{- end }}

  # ------------------------------------------------------------------------------
  # NTP Client Access Control
  # ------------------------------------------------------------------------------
  # Allow NTP client access from other nodes within the cluster's network CIDRs.
  {{- if .AllowNetworks }}
  {{- range .AllowNetworks }}
  allow {{ . }}
  {{- end }}
  {{- else }}
  # WARNING: No networks specified to allow. Other nodes may not be able to sync.
  # As a safe default, allowing access from the local subnet.
  # Consider defining Pod and Service CIDRs in your ClusterSpec for better security.
  allow 127.0.0.1
  {{- end }}

  # ------------------------------------------------------------------------------
  # Clock Control and Adjustment
  # ------------------------------------------------------------------------------
  # This directive enables the kernel's automatic time correction mechanism.
  driftfile /var/lib/chrony/drift
  
  # Step the system clock immediately on startup if the offset is larger than 1
  # second, but only do this for the first three clock updates.
  makestep 1.0 3
  
  # Enable kernel synchronization of the real-time clock (RTC).
  rtcsync
  
  # ------------------------------------------------------------------------------
  # Security for Command Access
  # ------------------------------------------------------------------------------
  # The following commands are often default but explicitly stated here for clarity.
  # They restrict access to the chronyd daemon to the local machine only.
  bindcmdaddress 127.0.0.1
  bindcmdaddress ::1
  
  # ------------------------------------------------------------------------------
  # Logging
  # ------------------------------------------------------------------------------
  # Specify the directory for log files.
  logdir /var/log/chrony

  # Log measurements, statistics, and tracking data.
# log measurements statistics tracking