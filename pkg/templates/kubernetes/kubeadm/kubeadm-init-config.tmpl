---
# Generated by kubexm. DO NOT EDIT.
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
etcd:
  {{- if .Etcd.IsExternal }}
  external:
    endpoints:
    {{- range .Etcd.Endpoints }}
    - {{ . }}
    {{- end }}
    caFile: {{ .Etcd.CaFile }}
    certFile: {{ .Etcd.CertFile }}
    keyFile: {{ .Etcd.KeyFile }}
  {{- else }}
  local:
    {{- if .ImageRepository }}
    imageRepository: {{ .ImageRepository }}
    {{- end }}
    {{- if .Etcd.Version }}
    imageTag: {{ .Etcd.Version }}
    {{- end }}
    {{- if .Etcd.DataDir }}
    dataDir: {{ .Etcd.DataDir }}
    {{- end }}
    {{- if .Etcd.ExtraArgs }}
    extraArgs:
      {{- range $key, $value := .Etcd.ExtraArgs }}
      "{{ $key }}": "{{ $value }}"
      {{- end }}
    {{- end }}
  {{- end }}
dns:
  type: CoreDNS
  {{- if .ImageRepository }}
  imageRepository: {{ .ImageRepository }}
  {{- end }}
  imageTag: {{ .DNS.ImageTag }}
{{- if .ImageRepository }}
imageRepository: {{ .ImageRepository }}
{{- end }}
kubernetesVersion: {{ .KubernetesVersion }}
certificatesDir: {{ .CertificatesDir }}
clusterName: {{ .ClusterName }}
controlPlaneEndpoint: {{ .ControlPlaneEndpoint }}
networking:
  dnsDomain: {{ .ClusterName }}
  podSubnet: {{ .Networking.PodSubnet }}
  serviceSubnet: {{ .Networking.ServiceSubnet }}
apiServer:
  {{- if .ApiServer.ExtraArgs }}
  extraArgs:
    {{- range $key, $value := .ApiServer.ExtraArgs }}
    "{{ $key }}": "{{ $value }}"
    {{- end }}
  {{- end }}
  {{- if .ApiServer.CertSANs }}
  certSANs:
    {{- range .ApiServer.CertSANs }}
    - "{{ . }}"
    {{- end }}
  {{- end }}
controllerManager:
  {{- if .ControllerManager.ExtraArgs }}
  extraArgs:
    {{- range $key, $value := .ControllerManager.ExtraArgs }}
    "{{ $key }}": "{{ $value }}"
    {{- end }}
  {{- end }}
  # This is a sensible default provided by kubexm, hardcoded in the template.
  extraVolumes:
    - name: host-time
      hostPath: /etc/localtime
      mountPath: /etc/localtime
      readOnly: true
scheduler:
  {{- if .Scheduler.ExtraArgs }}
  extraArgs:
    {{- range $key, $value := .Scheduler.ExtraArgs }}
    "{{ $key }}": "{{ $value }}"
    {{- end }}
  {{- end }}
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: {{ .InitConfiguration.LocalAPIEndpoint.AdvertiseAddress }}
  bindPort: {{ .InitConfiguration.LocalAPIEndpoint.BindPort }}
nodeRegistration:
  criSocket: {{ .InitConfiguration.NodeRegistration.CRISocket }}
  {{- if .InitConfiguration.NodeRegistration.KubeletExtraArgs }}
  kubeletExtraArgs:
    cgroup-driver: {{ .InitConfiguration.NodeRegistration.CgroupDriver }}
    {{- range $key, $value := .InitConfiguration.NodeRegistration.KubeletExtraArgs }}
    "{{ $key }}": "{{ $value }}"
    {{- end }}
  {{- end }}
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: {{ .KubeProxyConfiguration.Mode }}
clusterCIDR: {{ .Networking.PodSubnet }}
iptables:
  masqueradeAll: {{ .KubeProxyConfiguration.Iptables.MasqueradeAll }}
  masqueradeBit: {{ .KubeProxyConfiguration.Iptables.MasqueradeBit }}
  minSyncPeriod: "{{ .KubeProxyConfiguration.Iptables.MinSyncPeriod }}"
  syncPeriod: "{{ .KubeProxyConfiguration.Iptables.SyncPeriod }}"
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: {{ .InitConfiguration.NodeRegistration.CgroupDriver }}
clusterDNS:
- {{ .KubeletConfiguration.ClusterDNS }}
clusterDomain: {{ .ClusterName }}
{{- if .KubeletConfiguration.ContainerLogMaxFiles }}
containerLogMaxFiles: {{ .KubeletConfiguration.ContainerLogMaxFiles }}
{{- end }}
{{- if .KubeletConfiguration.ContainerLogMaxSize }}
containerLogMaxSize: "{{ .KubeletConfiguration.ContainerLogMaxSize }}"
{{- end }}
{{- if .KubeletConfiguration.EvictionHard }}
evictionHard:
  {{- range $key, $value := .KubeletConfiguration.EvictionHard }}
  "{{ $key }}": "{{ $value }}"
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.EvictionMaxPodGracePeriod }}
evictionMaxPodGracePeriod: {{ .KubeletConfiguration.EvictionMaxPodGracePeriod }}
{{- end }}
{{- if .KubeletConfiguration.EvictionPressureTransitionPeriod }}
evictionPressureTransitionPeriod: "{{ .KubeletConfiguration.EvictionPressureTransitionPeriod }}"
{{- end }}
{{- if .KubeletConfiguration.EvictionSoft }}
evictionSoft:
  {{- range $key, $value := .KubeletConfiguration.EvictionSoft }}
  "{{ $key }}": "{{ $value }}"
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.EvictionSoftGracePeriod }}
evictionSoftGracePeriod:
  {{- range $key, $value := .KubeletConfiguration.EvictionSoftGracePeriod }}
  "{{ $key }}": "{{ $value }}"
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.FeatureGates }}
featureGates:
  {{- range $key, $value := .KubeletConfiguration.FeatureGates }}
  "{{ $key }}": {{ $value }}
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.KubeReserved }}
kubeReserved:
  {{- range $key, $value := .KubeletConfiguration.KubeReserved }}
  "{{ $key }}": "{{ $value }}"
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.SystemReserved }}
systemReserved:
  {{- range $key, $value := .KubeletConfiguration.SystemReserved }}
  "{{ $key }}": "{{ $value }}"
  {{- end }}
{{- end }}
{{- if .KubeletConfiguration.MaxPods }}
maxPods: {{ .KubeletConfiguration.MaxPods }}
{{- end }}
{{- if .KubeletConfiguration.PodPidsLimit }}
podPidsLimit: {{ .KubeletConfiguration.PodPidsLimit }}
{{- end }}
{{- if .KubeletConfiguration.RotateCertificates }}
rotateCertificates: {{ .KubeletConfiguration.RotateCertificates }}
{{- end }}
{{- if .KubeletConfiguration.SerializeImagePulls }}
serializeImagePulls: {{ .KubeletConfiguration.SerializeImagePulls }}
{{- end }}